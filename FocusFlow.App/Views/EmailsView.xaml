<UserControl
    x:Class="FocusFlow.App.Views.EmailsView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:FocusFlow.App.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:FocusFlow.App"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="clr-namespace:FocusFlow.App.ViewModels"
    d:DesignHeight="600"
    d:DesignWidth="800"
    mc:Ignorable="d">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter" />
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />
    </UserControl.Resources>

    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*" />
            <ColumnDefinition Width="3*" />
        </Grid.ColumnDefinitions>

        <!--
            =========================
            LEFT: LIST
            =========================
        -->
        <Grid Grid.Column="0" Margin="0,0,10,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <StackPanel
                Grid.Row="0"
                Margin="0,0,0,10"
                Orientation="Horizontal">

                <TextBlock
                    VerticalAlignment="Center"
                    FontSize="24"
                    FontWeight="Bold"
                    Text="Emails" />

                <Button
                    Margin="20,0,0,0"
                    Padding="10,5"
                    HorizontalAlignment="Left"
                    Background="LightBlue"
                    Command="{Binding ShowSyncFormCommand}"
                    Content="ðŸ“¥ Sync" />

                <Button
                    Margin="10,0,0,0"
                    Padding="10,5"
                    HorizontalAlignment="Left"
                    Background="#FFCCCC"
                    Command="{Binding DeleteAllEmailsCommand}"
                    Content="ðŸ’¥ Delete All" />

                <Button
                    Margin="10,0,0,0"
                    Padding="10,5"
                    HorizontalAlignment="Left"
                    Background="LightCoral"
                    Command="{Binding DeleteSelectedEmailsCommand}"
                    Content="ðŸ—‘ Delete"
                    IsEnabled="{Binding HasSelectedEmails}" />

                <TextBlock
                    Margin="10,0,0,0"
                    VerticalAlignment="Center"
                    Text="{Binding SelectedEmailsCount, StringFormat='{}{0} selected'}"
                    Visibility="{Binding HasSelectedEmails, Converter={StaticResource BooleanToVisibilityConverter}}" />
            </StackPanel>

            <TextBox
                Grid.Row="1"
                Margin="0,0,0,10"
                Padding="5"
                Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}">
                <TextBox.Style>
                    <Style TargetType="TextBox">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="TextBox">
                                    <Border
                                        Padding="5"
                                        BorderBrush="LightGray"
                                        BorderThickness="1"
                                        CornerRadius="3">
                                        <ScrollViewer x:Name="PART_ContentHost" />
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </TextBox.Style>
            </TextBox>

            <ListBox
                Grid.Row="2"
                ItemsSource="{Binding EmailItems}"
                SelectedItem="{Binding SelectedEmailItem}">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border
                            Margin="0,5"
                            Padding="10"
                            BorderBrush="LightGray"
                            BorderThickness="1"
                            CornerRadius="5">
                            <StackPanel Orientation="Horizontal">

                                <CheckBox
                                    Margin="0,0,10,0"
                                    VerticalAlignment="Center"
                                    Command="{Binding DataContext.RefreshSelectionCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                    IsChecked="{Binding IsSelected, Mode=TwoWay}" />

                                <StackPanel>
                                    <TextBlock
                                        FontWeight="Bold"
                                        Text="{Binding Email.Subject}"
                                        TextWrapping="Wrap" />
                                    <TextBlock
                                        Margin="0,5,0,0"
                                        FontSize="12"
                                        Foreground="Gray"
                                        Text="{Binding Email.From}" />
                                    <TextBlock
                                        Margin="0,2,0,0"
                                        FontSize="11"
                                        Foreground="Gray"
                                        Text="{Binding Email.ReceivedUtc, StringFormat='{}{0:dd/MM/yyyy HH:mm}'}" />

                                    <TextBlock
                                        Margin="0,2,0,0"
                                        FontSize="11"
                                        Visibility="{Binding Email.PriorityScore, Converter={StaticResource ZeroToVisibilityConverter}}">
                                        <TextBlock.Text>
                                            <MultiBinding StringFormat="Priority: {0}">
                                                <Binding Path="Email.PriorityScore" />
                                            </MultiBinding>
                                        </TextBlock.Text>
                                        <TextBlock.Foreground>
                                            <Binding Converter="{StaticResource PriorityToColorConverter}" Path="Email.PriorityScore" />
                                        </TextBlock.Foreground>
                                    </TextBlock>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Grid>

        <!--
            =========================
            RIGHT: DETAIL + AI
            =========================
        -->
        <Border
            Grid.Column="1"
            Padding="15"
            BorderBrush="LightGray"
            BorderThickness="1"
            CornerRadius="5"
            Visibility="{Binding SelectedEmail, Converter={StaticResource NullToVisibilityConverter}}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <TextBlock
                    Grid.Row="0"
                    Margin="0,0,0,15"
                    VerticalAlignment="Center"
                    FontSize="20"
                    FontWeight="Bold"
                    Text="{Binding SelectedEmail.Subject}"
                    TextWrapping="Wrap" />

                <ScrollViewer Grid.Row="1">
                    <StackPanel>

                        <!--  ERROR BANNER  -->
                        <Border
                            Margin="0,0,0,10"
                            Padding="10"
                            Background="#FFEBEE"
                            BorderBrush="#D32F2F"
                            BorderThickness="1"
                            CornerRadius="6"
                            Visibility="{Binding ErrorMessage, Converter={StaticResource NullToVisibilityConverter}}">
                            <TextBlock
                                Foreground="#B71C1C"
                                Text="{Binding ErrorMessage}"
                                TextWrapping="Wrap" />
                        </Border>

                        <TextBlock Margin="0,0,0,5">
                            <Run FontWeight="Bold" Text="From:" />
                            <Run Text="{Binding SelectedEmail.From}" />
                        </TextBlock>

                        <TextBlock Margin="0,0,0,5">
                            <Run FontWeight="Bold" Text="Date:" />
                            <Run Text="{Binding SelectedEmail.ReceivedUtc, StringFormat='{}{0:dd/MM/yyyy HH:mm}'}" />
                        </TextBlock>

                        <StackPanel Margin="0,10,0,10" Orientation="Horizontal">
                            <Border
                                Margin="0,0,10,0"
                                Padding="5,2"
                                Background="#EEE"
                                CornerRadius="4">
                                <TextBlock FontWeight="SemiBold" Text="{Binding SelectedEmail.Category, StringFormat='ðŸ“‚ {0}'}" />
                            </Border>
                            <Border
                                Padding="5,2"
                                Background="#E6F3FF"
                                CornerRadius="4">
                                <TextBlock
                                    FontWeight="SemiBold"
                                    Foreground="#0055AA"
                                    Text="{Binding SelectedEmail.SuggestedAction, StringFormat='âš¡ {0}'}" />
                            </Border>

                            <Button
                                Margin="20,0,0,0"
                                Padding="10,2"
                                Background="#E0F7FA"
                                BorderBrush="#006064"
                                Command="{Binding CreateTaskFromEmailCommand}"
                                Foreground="#006064">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Margin="0,0,5,0" Text="ðŸ“…" />
                                    <TextBlock FontWeight="Bold" Text="Maak Taak" />
                                </StackPanel>
                            </Button>
                        </StackPanel>

                        <Separator Margin="0,10,0,10" />

                        <TextBlock
                            Margin="0,0,0,5"
                            FontSize="16"
                            FontWeight="Bold"
                            Text="Priority" />

                        <StackPanel Margin="0,0,0,15" Orientation="Horizontal">
                            <Slider
                                Width="200"
                                Margin="0,0,10,0"
                                Maximum="100"
                                Minimum="0"
                                Value="{Binding EmailPriorityScore, UpdateSourceTrigger=PropertyChanged}" />

                            <TextBlock
                                MinWidth="50"
                                VerticalAlignment="Center"
                                Text="{Binding EmailPriorityScore}" />

                            <Button
                                Margin="10,0,0,0"
                                Padding="10,5"
                                Command="{Binding UpdateEmailPriorityCommand}"
                                Content="Update Priority" />
                        </StackPanel>

                        <Separator Margin="0,10,0,10" />

                        <TextBlock
                            Margin="0,0,0,5"
                            FontSize="16"
                            FontWeight="Bold"
                            Text="Summary" />

                        <TextBlock
                            Margin="0,0,0,15"
                            Text="{Binding EmailSummary}"
                            TextWrapping="Wrap"
                            Visibility="{Binding EmailSummary, Converter={StaticResource NullToVisibilityConverter}}" />

                        <TextBlock
                            Margin="0,0,0,15"
                            Foreground="Gray"
                            Text="No summary available"
                            Visibility="{Binding EmailSummary, Converter={StaticResource NullToInverseVisibilityConverter}}" />

                        <Separator Margin="0,10,0,10" />

                        <TextBlock
                            Margin="0,0,0,5"
                            FontSize="16"
                            FontWeight="Bold"
                            Text="Body" />

                        <TextBlock
                            Margin="0,0,0,10"
                            Text="{Binding SelectedEmail.BodyText}"
                            TextWrapping="Wrap" />

                        <Separator Margin="0,10,0,10" />

                        <!--  TOGGLES  -->
                        <StackPanel Margin="0,0,0,10" Orientation="Horizontal">
                            <Button
                                Margin="0,0,10,0"
                                Padding="10,5"
                                Background="#4CAF50"
                                Command="{Binding ToggleDraftReplyCommand}"
                                FontWeight="Bold"
                                Foreground="White">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Margin="0,0,5,0" Text="âœ¨" />
                                    <TextBlock Text="Draft Reply" />
                                </StackPanel>
                            </Button>

                            <Button
                                Margin="0,0,10,0"
                                Padding="10,5"
                                Background="#1976D2"
                                Command="{Binding ToggleComposeCommand}"
                                FontWeight="Bold"
                                Foreground="White">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Margin="0,0,5,0" Text="âœï¸" />
                                    <TextBlock Text="Compose Mail" />
                                </StackPanel>
                            </Button>

                            <Button
                                Padding="10,5"
                                Background="#6A1B9A"
                                Command="{Binding ToggleAiTasksCommand}"
                                FontWeight="Bold"
                                Foreground="White">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Margin="0,0,5,0" Text="ðŸ§ " />
                                    <TextBlock Text="AI Tasks" />
                                </StackPanel>
                            </Button>
                        </StackPanel>

                        <!--  Draft Reply  -->
                        <StackPanel Visibility="{Binding IsDraftReplyVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBlock
                                Margin="0,0,0,5"
                                FontSize="16"
                                FontWeight="Bold"
                                Text="Draft Reply" />

                            <StackPanel Margin="0,0,0,10">
                                <StackPanel Margin="0,0,0,10" Orientation="Horizontal">
                                    <TextBlock
                                        MinWidth="50"
                                        Margin="0,0,5,0"
                                        VerticalAlignment="Center"
                                        Text="Tone:" />

                                    <ComboBox
                                        Width="120"
                                        Margin="0,0,20,0"
                                        SelectedValue="{Binding SelectedTone, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        SelectedValuePath="Content">
                                        <ComboBox.Items>
                                            <ComboBoxItem Content="Neutral" />
                                            <ComboBoxItem Content="Friendly" />
                                            <ComboBoxItem Content="Formal" />
                                        </ComboBox.Items>
                                    </ComboBox>

                                    <TextBlock
                                        MinWidth="60"
                                        Margin="0,0,5,0"
                                        VerticalAlignment="Center"
                                        Text="Length:" />

                                    <ComboBox
                                        Width="120"
                                        Margin="0,0,20,0"
                                        SelectedValue="{Binding SelectedLength, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        SelectedValuePath="Content">
                                        <ComboBox.Items>
                                            <ComboBoxItem Content="Short" />
                                            <ComboBoxItem Content="Medium" />
                                            <ComboBoxItem Content="Long" />
                                        </ComboBox.Items>
                                    </ComboBox>

                                    <Button
                                        Padding="10,5"
                                        Background="#4CAF50"
                                        Command="{Binding GenerateDraftReplyCommand}"
                                        FontWeight="Bold"
                                        Foreground="White">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Margin="0,0,5,0" Text="âœ¨" />
                                            <TextBlock Text="Generate Reply" />
                                        </StackPanel>
                                    </Button>
                                </StackPanel>

                                <StackPanel
                                    Margin="0,0,0,5"
                                    Orientation="Horizontal"
                                    Visibility="{Binding IsGeneratingReply, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <TextBlock
                                        FontWeight="SemiBold"
                                        Foreground="#4CAF50"
                                        Text="â³ Generating reply..." />
                                    <ProgressBar
                                        Width="200"
                                        Height="10"
                                        Margin="10,0,0,0"
                                        IsIndeterminate="True" />
                                </StackPanel>

                                <TextBox
                                    MinHeight="150"
                                    Padding="5"
                                    AcceptsReturn="True"
                                    BorderBrush="LightGray"
                                    BorderThickness="1"
                                    IsReadOnly="False"
                                    Text="{Binding DraftReply}"
                                    TextWrapping="Wrap"
                                    VerticalScrollBarVisibility="Auto" />
                            </StackPanel>

                            <Separator Margin="0,15,0,15" />
                        </StackPanel>

                        <!--  Compose  -->
                        <StackPanel Visibility="{Binding IsComposeVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBlock
                                Margin="0,0,0,5"
                                FontSize="16"
                                FontWeight="Bold"
                                Text="Compose New Email (AI)" />

                            <TextBlock Text="Wat wil je in deze e-mail zeggen? *" />
                            <TextBox
                                MinHeight="80"
                                Margin="0,5,0,10"
                                AcceptsReturn="True"
                                Text="{Binding ComposePrompt, UpdateSourceTrigger=PropertyChanged}"
                                TextWrapping="Wrap"
                                VerticalScrollBarVisibility="Auto" />

                            <TextBlock Text="Subject (optioneel)" />
                            <TextBox Margin="0,5,0,10" Text="{Binding ComposeSubject, UpdateSourceTrigger=PropertyChanged}" />

                            <TextBlock Text="Extra instructies (optioneel)" />
                            <TextBox
                                Margin="0,5,0,10"
                                AcceptsReturn="True"
                                Text="{Binding ComposeInstructions, UpdateSourceTrigger=PropertyChanged}"
                                TextWrapping="Wrap"
                                VerticalScrollBarVisibility="Auto" />

                            <Button
                                Padding="10,5"
                                Background="#1976D2"
                                Command="{Binding GenerateComposeEmailCommand}"
                                FontWeight="Bold"
                                Foreground="White">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Margin="0,0,5,0" Text="âœ¨" />
                                    <TextBlock Text="Genereer nieuwe e-mail" />
                                </StackPanel>
                            </Button>

                            <StackPanel
                                Margin="0,8,0,8"
                                Orientation="Horizontal"
                                Visibility="{Binding IsComposingEmail, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock
                                    FontWeight="SemiBold"
                                    Foreground="#1976D2"
                                    Text="â³ Genereren..." />
                                <ProgressBar
                                    Width="150"
                                    Height="10"
                                    Margin="10,0,0,0"
                                    IsIndeterminate="True" />
                            </StackPanel>

                            <TextBlock
                                Margin="0,10,0,5"
                                FontWeight="Bold"
                                Text="Gegenereerde e-mail" />

                            <TextBlock FontWeight="SemiBold" Text="Subject:" />
                            <TextBox
                                Margin="0,0,0,10"
                                IsReadOnly="True"
                                Text="{Binding ComposedSubject}"
                                TextWrapping="Wrap" />

                            <TextBlock FontWeight="SemiBold" Text="Body:" />
                            <TextBox
                                MinHeight="150"
                                Padding="5"
                                AcceptsReturn="True"
                                IsReadOnly="True"
                                Text="{Binding ComposedBody}"
                                TextWrapping="Wrap"
                                VerticalScrollBarVisibility="Auto" />

                            <Separator Margin="0,15,0,15" />
                        </StackPanel>

                        <!--  AI Tasks  -->
                        <StackPanel Visibility="{Binding IsAiTasksVisible, Converter={StaticResource BooleanToVisibilityConverter}}">

                            <TextBlock
                                Margin="0,0,0,8"
                                FontSize="16"
                                FontWeight="Bold"
                                Text="AI Tasks (from this mail)" />

                            <StackPanel Margin="0,0,0,10" Orientation="Horizontal">
                                <Button
                                    Padding="10,5"
                                    Background="#6A1B9A"
                                    Command="{Binding ExtractTasksCommand}"
                                    FontWeight="Bold"
                                    Foreground="White">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Margin="0,0,5,0" Text="ðŸ§ " />
                                        <TextBlock Text="Extract tasks" />
                                    </StackPanel>
                                </Button>

                                <Button
                                    Margin="10,0,0,0"
                                    Padding="10,5"
                                    Background="#2E7D32"
                                    Command="{Binding CreateSelectedAiTasksCommand}"
                                    FontWeight="Bold"
                                    Foreground="White">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Margin="0,0,5,0" Text="âœ…" />
                                        <TextBlock Text="Create selected" />
                                    </StackPanel>
                                </Button>
                            </StackPanel>

                            <StackPanel
                                Margin="0,0,0,10"
                                Orientation="Horizontal"
                                Visibility="{Binding IsExtractingTasks, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock
                                    FontWeight="SemiBold"
                                    Foreground="#6A1B9A"
                                    Text="â³ Extracting tasks..." />
                                <ProgressBar
                                    Width="200"
                                    Height="10"
                                    Margin="10,0,0,0"
                                    IsIndeterminate="True" />
                            </StackPanel>

                            <!--  Clarifications  -->
                            <StackPanel Visibility="{Binding HasClarifications, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock
                                    Margin="0,0,0,5"
                                    FontWeight="Bold"
                                    Text="Needs clarification:" />
                                <ItemsControl ItemsSource="{Binding NeedsClarification}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock TextWrapping="Wrap">
                                                <Run Text="â€¢ " />
                                                <Run Text="{Binding Mode=OneWay}" />
                                            </TextBlock>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                                <Separator Margin="0,10,0,10" />
                            </StackPanel>

                            <!--  Suggestions  -->
                            <ItemsControl ItemsSource="{Binding TaskSuggestions}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border
                                            Margin="0,0,0,10"
                                            Padding="10"
                                            BorderBrush="LightGray"
                                            BorderThickness="1"
                                            CornerRadius="6">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <CheckBox
                                                    Grid.Column="0"
                                                    Margin="0,2,10,0"
                                                    IsChecked="{Binding IsSelected, Mode=TwoWay}" />

                                                <StackPanel Grid.Column="1">
                                                    <TextBlock
                                                        FontWeight="Bold"
                                                        Text="{Binding Title, Mode=OneWay}"
                                                        TextWrapping="Wrap" />

                                                    <TextBlock
                                                        Margin="0,4,0,0"
                                                        Foreground="Gray"
                                                        Text="{Binding Description, Mode=OneWay}"
                                                        TextWrapping="Wrap"
                                                        Visibility="{Binding Description, Converter={StaticResource NullToVisibilityConverter}}" />

                                                    <StackPanel Margin="0,6,0,0" Orientation="Horizontal">
                                                        <Border
                                                            Margin="0,0,8,0"
                                                            Padding="5,2"
                                                            Background="#EEE"
                                                            CornerRadius="4">
                                                            <TextBlock Text="{Binding Priority, Mode=OneWay, StringFormat='Priority: {0}'}" />
                                                        </Border>

                                                        <Border
                                                            Margin="0,0,8,0"
                                                            Padding="5,2"
                                                            Background="#E8F5E9"
                                                            CornerRadius="4"
                                                            Visibility="{Binding HasDue, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                            <TextBlock Text="{Binding DueDisplay, Mode=OneWay, StringFormat='Due: {0}'}" />
                                                        </Border>

                                                        <Border
                                                            Padding="5,2"
                                                            Background="#FFF3E0"
                                                            CornerRadius="4">
                                                            <TextBlock Text="{Binding Confidence, Mode=OneWay, StringFormat='Conf: {0:0.00}'}" />
                                                        </Border>
                                                    </StackPanel>

                                                    <TextBlock
                                                        Margin="0,6,0,0"
                                                        Foreground="#555"
                                                        TextWrapping="Wrap"
                                                        Visibility="{Binding HasSource, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                        <Run FontWeight="Bold" Text="Quote: " />
                                                        <Run Text="{Binding SourceQuote, Mode=OneWay}" />
                                                    </TextBlock>
                                                </StackPanel>

                                                <Button
                                                    Grid.Column="2"
                                                    Margin="10,0,0,0"
                                                    Padding="10,5"
                                                    Background="#2E7D32"
                                                    Command="{Binding DataContext.CreateSingleAiTaskCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}"
                                                    FontWeight="Bold"
                                                    Foreground="White">
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock Margin="0,0,5,0" Text="âž•" />
                                                        <TextBlock Text="Create" />
                                                    </StackPanel>
                                                </Button>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <TextBlock
                                Foreground="Gray"
                                Text="No AI task suggestions yet. Click 'Extract tasks'."
                                Visibility="{Binding HasTaskSuggestions, Converter={StaticResource InverseBooleanToVisibilityConverter}}" />

                            <Separator Margin="0,15,0,5" />
                        </StackPanel>

                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Border>

        <!--  SYNC MODAL  -->
        <Border
            Grid.ColumnSpan="2"
            Width="500"
            Padding="20"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Background="White"
            BorderBrush="Black"
            BorderThickness="2"
            CornerRadius="10"
            Visibility="{Binding IsSyncFormVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel>
                <TextBlock
                    Margin="0,0,0,20"
                    FontSize="18"
                    FontWeight="Bold"
                    Text="Sync Emails" />

                <StackPanel>
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsSyncing}" Value="True">
                                    <Setter Property="IsEnabled" Value="False" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>

                    <TextBlock Margin="0,0,0,5" Text="Email Account *" />
                    <ComboBox
                        Margin="0,0,0,15"
                        ItemsSource="{Binding AvailableAccounts}"
                        SelectedItem="{Binding SelectedSyncAccount}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel>
                                    <TextBlock FontWeight="Bold" Text="{Binding DisplayName}" />
                                    <TextBlock
                                        FontSize="11"
                                        Foreground="Gray"
                                        Text="{Binding EmailAddress}" />
                                    <TextBlock
                                        FontSize="10"
                                        Foreground="Gray"
                                        Text="{Binding Provider}" />
                                </StackPanel>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                    <TextBlock Margin="0,0,0,5" Text="Max Count (1-500) *" />
                    <TextBox Margin="0,0,0,15" Text="{Binding SyncMaxCount, UpdateSourceTrigger=PropertyChanged, TargetNullValue=20, FallbackValue=20}" />
                </StackPanel>

                <StackPanel Margin="0,0,0,15" Visibility="{Binding IsSyncing, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <TextBlock
                        Margin="0,0,0,5"
                        HorizontalAlignment="Center"
                        FontWeight="Bold"
                        Foreground="#0055AA"
                        Text="âŒ› Bezig met ophalen en AI Analyse..." />
                    <ProgressBar Height="10" IsIndeterminate="True" />
                    <TextBlock
                        Margin="0,2,0,0"
                        HorizontalAlignment="Center"
                        FontSize="10"
                        Foreground="Gray"
                        Text="(Dit kan even duren)" />
                </StackPanel>

                <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                    <Button
                        Margin="5,0"
                        Padding="15,5"
                        Command="{Binding CancelSyncFormCommand}"
                        Content="Cancel">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsSyncing}" Value="True">
                                        <Setter Property="IsEnabled" Value="False" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>

                    <Button
                        Margin="5,0"
                        Padding="15,5"
                        Background="LightGreen"
                        Command="{Binding ExecuteSyncCommand}"
                        Content="Sync">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsSyncing}" Value="True">
                                        <Setter Property="IsEnabled" Value="False" />
                                        <Setter Property="Content" Value="Bezig..." />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </StackPanel>
            </StackPanel>
        </Border>

    </Grid>
</UserControl>
